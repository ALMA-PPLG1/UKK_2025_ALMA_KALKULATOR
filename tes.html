<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <input type="text" class="display" id="display" disabled>
        <div class="buttons">
            <button class="operator" data-value="AC">AC</button>
            <button class="operator" data-value="DEL">DEL</button>
            <button class="operator" data-value="%">-</button> <!-- Ganti fungsi persen menjadi minus -->
            <button class="operator" data-value="/">/</button>

            <button data-value="7">7</button>
            <button data-value="8">8</button>
            <button data-value="9">9</button>
            <button class="operator" data-value="*">*</button>

            <button data-value="4">4</button>
            <button data-value="5">5</button>
            <button data-value="6">6</button>
            <button class="operator" data-value="-">-</button>

            <button data-value="1">1</button>
            <button data-value="2">2</button>
            <button data-value="3">3</button>
            <button class="operator" data-value="+">+</button>

            <button data-value="0">0</button>
            <button data-value="00">00</button>
            <button data-value=".">.</button>
            <button id="twoblok" class="operator" data-value="=">=</button>
        </div>
    </div>

    <script>
        const display = document.querySelector(".display");
        const buttons = document.querySelectorAll("button");
        let input = "";
        let operatorUsed = false; // Untuk memeriksa apakah operator telah digunakan
        let decimalUsed = false; // Untuk memeriksa apakah titik desimal telah digunakan
        let resultDisplayed = false; // Untuk memeriksa apakah hasil ditampilkan

        // Format angka dengan pemisah ribuan
        const formatNumber = (num) => {
            let [integer, decimal] = num.toString().split('.');
            integer = integer.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            return decimal ? `${integer}.${decimal}` : integer;
        };

        // Hapus pemisah ribuan untuk perhitungan
        const removeThousandSeparators = (num) => {
            return num.replace(/\./g, '');
        };

        // Perbarui nilai tampilan
        const updateDisplay = () => {
            display.value = formatNumber(input);
        };

        // Tangani klik tombol
        buttons.forEach(button => {
            button.addEventListener("click", () => {
                const value = button.getAttribute("data-value");

                if (value === "AC") {
                    input = "";
                    operatorUsed = false;
                    decimalUsed = false;
                    resultDisplayed = false; // Reset status hasil
                    updateDisplay();
                    return;
                }

                if (value === "DEL") {
                    input = input.slice(0, -1);
                    if (input.includes(".")) {
                        decimalUsed = true;
                    }
                    operatorUsed = false;
                    updateDisplay();
                    return;
                }

                if (value === "=") {
                    // Hapus pemisah ribuan sebelum perhitungan
                    let calcInput = removeThousandSeparators(input);

                    try {
                        let result = eval(calcInput);
                        input = result.toString();
                        updateDisplay();
                        resultDisplayed = true; // Tandai hasil ditampilkan
                    } catch (error) {
                        input = "Error";
                        updateDisplay();
                        resultDisplayed = false; // Reset status hasil
                    }

                    operatorUsed = false;
                    decimalUsed = false;
                    return;
                }

                if (["+", "-", "*", "/"].includes(value)) {
                    if (operatorUsed) return; // Mencegah operator berturut-turut
                    if (input === "" && value !== "-") return; // Mencegah memulai dengan operator kecuali minus

                    // Jika hasil ditampilkan, lanjutkan dengan operator
                    if (resultDisplayed) {
                        input += value;
                        resultDisplayed = false; // Reset status hasil
                    } else {
                        input += value;
                    }

                    operatorUsed = true;
                    decimalUsed = false; // Reset penggunaan desimal setelah operator
                    updateDisplay();
                    return;
                }

                if (value === ".") {
                    if (decimalUsed) return; // Mencegah desimal ganda dalam satu angka
                    input += value;
                    decimalUsed = true;
                    updateDisplay();
                    return;
                }

                // Menangani tombol minus (sekarang berfungsi sebagai pengurangan)
                if (value === "%") {
                    if (input === "") return; // Tidak melakukan apa-apa jika input kosong
                    let calcInput = removeThousandSeparators(input);
                    let lastNumber = parseFloat(calcInput.split(/[\+\-\*\/]/).pop()); // Ambil angka terakhir
                    let newValue = -lastNumber; // Mengubah angka terakhir menjadi negatif
                    input = input.slice(0, -lastNumber.toString().length) + newValue; // Ganti angka terakhir dengan nilai baru
                    updateDisplay();
                    return;
                }

                // Izinkan input angka dan reset input jika hasil sebelumnya ditampilkan
                if (resultDisplayed) {
                    input = ""; // Hapus pesan kesalahan atau reset input setelah operasi
                    resultDisplayed = false; // Reset status hasil
                }

                input += value;
                operatorUsed = false; // Reset penggunaan operator setelah menambahkan angka
                updateDisplay();
            });
        });
    </script>
</body>
</html>